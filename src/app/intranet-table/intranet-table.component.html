<div class="fondo">
  <aside class="sidebar" [ngClass]="{'is-visible': isSidebarVisible}">
    <button class="toggle-sidebar" (click)="toggleSidebar()">
      <i class="fa" [class.fa-times]="isSidebarVisible" [class.fa-arrow-left]="!isSidebarVisible"></i>
    </button>
    <nav class="nav-menu">
      <ul>
        <li><a (click)="goForm($event)">Añadir nuevo usuario o nueva tienda</a></li>
        <li><a (click)="goConsulta($event)">Ver Resultados Encuesta</a></li>
        <li><a (click)="goGenerador($event)">Ir al Generador</a></li>
      </ul>
    </nav>
  </aside>
  <button class="btn btn-secondary" (click)="alternarFormularioAgregarUsuario()">Añadir nueva fila</button>

  <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table table-striped table-bordered hover">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Email</th>
        <th>Nombre Completo</th>
        <th>Contraseña</th>
        <th>Nombre de Tienda</th>
        <th>Teléfono</th>
        <th>Nº Ticket</th>
        <th>Puntos Juego</th>
        <th>Puntos Encuesta</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of usuarios; let i = index">
        <ng-container *ngIf="!usuarioEditando || usuarioEditando.nombre_user !== user.nombre_user">
          <td>{{ user.nombre_user }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.nombre_compl_user }}</td>
          <td>{{ user.contrasenia }}</td>
          <td>{{ user.nombre_tienda }}</td>
          <td>{{ user.telefono }}</td>
          <td>{{ user.num_ticket }}</td>
          <td>{{ user.puntos_juego }}</td>
          <td>{{ user.puntos_encuesta }}</td>
          <td>
            <button class="btn btn-info" (click)="editarUsuario(user)">Editar</button>
            <button class="btn btn-danger" (click)="eliminarUsuario(user, i)">Eliminar</button>
          </td>
        </ng-container>
        <ng-container *ngIf="usuarioEditando && usuarioEditando.nombre_user === user.nombre_user">
          <td><input type="text" [(ngModel)]="usuarioEditando.nombre_user" disabled /></td>
          <td><input type="email" [(ngModel)]="usuarioEditando.email" /></td>
          <td><input type="text" [(ngModel)]="usuarioEditando.nombre_compl_user" /></td>
          <td><input type="text" [(ngModel)]="usuarioEditando.contrasenia" /></td>
          <td>
            <select [(ngModel)]="usuarioEditando.nombre_tienda">
              <option value="">(Ninguna)</option>
              <option *ngFor="let tienda of tiendas" [value]="tienda.nombre_tienda">{{ tienda.nombre_tienda }}</option>
            </select>
          </td>
          <td><input type="text" [(ngModel)]="usuarioEditando.telefono" /></td>
          <td><input type="number" [(ngModel)]="usuarioEditando.num_ticket" /></td>
          <td><input type="number" [(ngModel)]="usuarioEditando.puntos_juego" /></td>
          <td><input type="number" [(ngModel)]="usuarioEditando.puntos_encuesta" /></td>
          <td>
            <button class="btn btn-success" (click)="guardarCambiosUsuario()">Guardar</button>
            <button class="btn btn-danger" (click)="cancelarEdicionUsuario()">Cancelar</button>
          </td>
        </ng-container>
      </tr>

      <tr *ngIf="mostrarFormularioAgregarUsuario" class="add-user-form">
        <td><input type="text" [(ngModel)]="nuevoUsuario.nombre_user" name="nombre" /></td>
        <td><input type="email" [(ngModel)]="nuevoUsuario.email" name="email" /></td>
        <td><input type="text" [(ngModel)]="nuevoUsuario.nombre_compl_user" name="nombreCompleto" /></td>
        <td><input type="password" [(ngModel)]="nuevoUsuario.contrasenia" name="contrasena" /></td>
        <td>
          <select [(ngModel)]="nuevoUsuario.nombre_tienda" name="nombreTienda">
            <option value="">(Ninguna)</option>
            <option *ngFor="let tienda of tiendas" [value]="tienda.nombre_tienda">{{ tienda.nombre_tienda }}</option>
          </select>
        </td>
        <td><input type="text" [(ngModel)]="nuevoUsuario.telefono" name="telefono" /></td>
        <td><input type="number" [(ngModel)]="nuevoUsuario.num_ticket" name="numTicket" /></td>
        <td><input type="number" [(ngModel)]="nuevoUsuario.puntos_juego" name="puntosJuego" /></td>
        <td><input type="number" [(ngModel)]="nuevoUsuario.puntos_encuesta" name="puntosEncuesta" /></td>
        <td>
          <button type="button" class="btn btn-success" (click)="onSubmitAgregarUsuario()">Añadir</button>
          <button type="button" class="btn btn-danger" (click)="cancelarAgregarUsuario()">Cancelar</button>
        </td>
      </tr>
    </tbody>
  </table>
  <button (click)="goHome()" style="margin-bottom: 30px;">Volver Atras</button>
</div>
